<div id="page-contents">
  <div class="container">
    <div class="row">

      <app-left-bar></app-left-bar>
      <div class="col-md-7">
        <app-publish></app-publish>

        <!-- Post Content
              ================================================= -->
        <div *ngFor="let post of postsResponse.data">
          <div class="post-content">
            <!-- Post Header -->
            <div class="post-header flex justify-between items-start mb-3">
              <!-- Author Info -->
              <div class="flex items-center gap-3">
                <img
                  [src]="unKnownImage"
                  alt="user"
                  class="profile-photo-md"
                />
                <div class="author-info">
                  <a href="timeline.html" class="profile-link font-semibold text-gray-800 hover:underline">
                    {{ post.account.firstName }} {{ post.account.lastName }}
                  </a>
                  <p class="post-time text-sm text-gray-500">{{ getTimeAgo(post.createdDate) }}</p>
                </div>
              </div>
              <!-- Use fixed positioning -->
              <div class="relative inline-block">
                <button
                  class="btn-options text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100"
                  (click)="dropdown.hidden = !dropdown.hidden">
                  <i class="fa fa-ellipsis-h"></i>
                </button>

                <div #dropdown
                     hidden
                     class="fixed mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50"
                     [style.top.px]="dropdownTop"
                     [style.right.px]="dropdownRight">
                  <div class="py-1">
                    <button (click)="onEditPost(post); dropdown.hidden = true"
                            class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3">
                      <i class="fa fa-edit text-blue-500"></i>
                      <span>Edit Post</span>
                    </button>
                    <div class="border-t border-gray-200 my-1"></div>
                    <button (click)="onDeletePost(post); dropdown.hidden = true"
                            class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center gap-3">
                      <i class="fa fa-trash"></i>
                      <span>Delete Post</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>


            <!-- Post Text -->
            <div class="post-text" *ngIf="post.content&&!(edit&&editId===post.id)">
              <p>{{ post.content }}</p>
            </div>
            <!-- Post Text - Edit Mode -->
            <div class="post-text" *ngIf="edit&&editId===post.id">
              <textarea
                [(ngModel)]="post.content"
                class="edit-textarea"
                [placeholder]="post.content==null?'what\'s in your mind':post.content"
                rows="4">
              </textarea>
              <div class="edit-actions">
                <button class="btn-cancel" (click)="closeDropdown()">
                  Cancel
                </button>
                <button class="btn-save" (click)="savePostEdit(post)">
                  Save Changes
                </button>
              </div>
            </div>

            <!-- Post Image -->
            <div class="post-media-container" *ngIf="post.media">
              <!-- Image -->
              <img
                *ngIf="isImage(post.media)"
                [src]="getFullMediaPost(post.media)"
                alt="post-image"
                class="post-image"
              />

              <!-- Video -->
              <video
                *ngIf="isVideo(post.media)"
                [src]="getFullMediaPost(post.media)"
                controls
                class="post-video"
              ></video>
            </div>

            <!-- Post Stats -->
            <div class="post-stats" *ngIf="post.reactionsCount > 0 || post.commentsCount > 0">
              <div class="reactions" *ngIf="post.reactionsCount > 0">
                <div class="reaction-icons">
                  <i class="fa fa-thumbs-up"></i>
                  <i class="fa fa-heart"></i>
                  <i class="fa fa-laugh"></i>
                </div>
                <span class="reaction-count">{{ post.reactionsCount }}</span>
              </div>
              <div class="comments-count" *ngIf="post.commentsCount > 0">
                <a href="#" class="comments-link" (click)="toggleComments(); $event.preventDefault()">
                  {{ post.commentsCount }} comment{{ post.comments !== 1 ? 's' : '' }}
                </a>
              </div>
            </div>

            <!-- Post Actions -->
            <div class="post-actions">
              <button class="action-btn like-btn" [class.liked]="post.liked" (click)="toggleLike(post)">
                <i class="fa fa-thumbs-up"></i>
                <span>{{ post.liked ? 'Liked' : 'Like' }}</span>
              </button>
              <button class="action-btn comment-btn" (click)="comments(post.id)">
                <i class="fa fa-comment"></i>
                <span>Comment</span>
              </button>
              <button class="action-btn share-btn">
                <i class="fa fa-share"></i>
                <span>Share</span>
              </button>
            </div>
          </div>
        </div>


      </div>
      <app-right-bar></app-right-bar>
    </div>
  </div>
</div>
