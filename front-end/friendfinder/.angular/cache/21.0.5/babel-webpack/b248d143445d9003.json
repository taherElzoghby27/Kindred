{"ast":null,"code":"import { __decorate, __param } from \"tslib\";\nimport { Component, Inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { GeneralResponse } from '../../../../model/general-response';\nimport { CommentRequestVm } from '../../../../model/comment-request-vm';\nimport { SnackbarPanelClass } from '../../../../enum/snackbar-panel-class.enum';\n// @ts-ignore\nlet DialogCommentsComponent = class DialogCommentsComponent {\n  constructor(commentService, dialogRef, data, authService, activatedRoute, snackBar) {\n    this.commentService = commentService;\n    this.dialogRef = dialogRef;\n    this.data = data;\n    this.authService = authService;\n    this.activatedRoute = activatedRoute;\n    this.snackBar = snackBar;\n    this.unKnownImage = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcgO0A7rA9MJx0DQn3Vk_kgso2c_Na-J56yA&s';\n    this.countComments = 0;\n    // Edit state\n    this.editingCommentId = null;\n    this.editedContent = '';\n    this.page = 1;\n    this.limit = 10;\n  }\n  ngOnInit() {\n    this.activatedRoute.params.subscribe(params => this.getAllComments());\n  }\n  onClose() {\n    this.dialogRef.close({\n      countComments: this.countComments,\n      postId: this.data.post_id\n    });\n  }\n  onScroll() {\n    this.page++;\n    this.getAllComments();\n  }\n  getAllComments() {\n    this.commentService.getComments(this.data.post_id, this.page, this.limit).subscribe(comments => {\n      if (this.page === 1) {\n        this.comments = comments;\n      } else {\n        this.comments.data.push(...comments.data);\n      }\n    }, errors => {});\n  }\n  // Add new comment\n  addComment() {\n    if (this.newComment.trim()) {\n      const comment = new CommentRequestVm(this.newComment.trim(), this.data.post_id);\n      this.commentService.createComment(comment).subscribe(response => {\n        if (this.comments == null) {\n          this.comments = new GeneralResponse([], 1, 10);\n        }\n        this.comments.data.push(response);\n        this.newComment = '';\n        this.countComments++;\n      }, errors => {\n        this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n      });\n    }\n  }\n  isCurrentUserComment(comment) {\n    return comment.account?.id.toString() === this.authService.getAccountId();\n  }\n  confirmDelete(commentId) {\n    this.commentService.deleteComment(commentId).subscribe({\n      next: () => {\n        this.comments.data = this.comments.data.filter(c => c.id !== commentId);\n        this.countComments--;\n      },\n      error: errors => {\n        this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n      }\n    });\n  }\n  // Handle enter key in comment input\n  onCommentKeyPress(event) {\n    if (event.key === 'Enter') {\n      this.addComment();\n    }\n  }\n  startEdit(comment) {\n    this.editingCommentId = comment.id;\n    this.editedContent = comment.content;\n  }\n  cancelEdit() {\n    this.editingCommentId = null;\n    this.editedContent = null;\n  }\n  saveEdit(commentResponse) {\n    const comment = new CommentRequestVm(commentResponse.content, commentResponse.post_id, commentResponse.id);\n    this.commentService.updateComment(comment).subscribe(response => {\n      this.cancelEdit();\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  getTimeAgo(input) {\n    // Convert to Date object if it's a string\n    const date = typeof input === 'string' ? new Date(input) : input;\n    const now = new Date();\n    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n    if (seconds < 60) {\n      return 'Just now';\n    }\n    if (seconds < 3600) {\n      return Math.floor(seconds / 60) + 'm ago';\n    }\n    if (seconds < 86400) {\n      return Math.floor(seconds / 3600) + 'h ago';\n    }\n    if (seconds < 604800) {\n      return Math.floor(seconds / 86400) + 'd ago';\n    }\n    if (seconds < 2592000) {\n      return Math.floor(seconds / 604800) + 'w ago';\n    }\n    if (seconds < 31536000) {\n      return Math.floor(seconds / 2592000) + 'mo ago';\n    }\n    return Math.floor(seconds / 31536000) + 'y ago';\n  }\n  getCurrentUser() {\n    return this.authService.getCurrentUser();\n  }\n  showSnackBar(message, snackType) {\n    this.snackBar.open(message, 'Close', {\n      duration: 3000,\n      // milliseconds\n      verticalPosition: 'bottom',\n      // or 'top'\n      panelClass: [snackType]\n    });\n  }\n};\nDialogCommentsComponent = __decorate([Component({\n  standalone: true,\n  imports: [CommonModule, FormsModule, MatDialogModule, MatFormFieldModule, MatInputModule, MatButtonModule, MatIconModule],\n  selector: 'app-dialog-comments',\n  templateUrl: './dialog-comments.component.html',\n  styleUrls: ['./dialog-comments.component.css']\n}), __param(2, Inject(MAT_DIALOG_DATA))], DialogCommentsComponent);\nexport { DialogCommentsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}