{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { ReactionRequestVm, ReactionType } from '../../../../model/reaction-request-vm';\nimport { DialogCommentsComponent } from '../dialog-comments/dialog-comments.component';\nimport { PostRequest } from '../../../../model/post-request';\nimport { SnackbarPanelClass } from '../../../../enum/snackbar-panel-class.enum';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { LeftBarComponent } from '../left-bar/left-bar.component';\nimport { RightBarComponent } from '../right-bar/right-bar.component';\nimport { PublishComponent } from '../publish/publish.component';\nlet MainPageComponent = class MainPageComponent {\n  constructor(postService, reactionService, dialog, snackBar, authService, sharedService) {\n    this.postService = postService;\n    this.reactionService = reactionService;\n    this.dialog = dialog;\n    this.snackBar = snackBar;\n    this.authService = authService;\n    this.sharedService = sharedService;\n    this.isDropdownOpen = false;\n    this.unKnownImage = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcgO0A7rA9MJx0DQn3Vk_kgso2c_Na-J56yA&s';\n    this.edit = false;\n    this.page = 1;\n    this.limit = 10;\n  }\n  ngOnInit() {\n    this.sharedService.currentMessage.subscribe(msg => {\n      if (msg === '') {\n        this.getAllPosts();\n      } else {\n        this.searchByContent(msg);\n      }\n    });\n  }\n  getBaseUrlForMedia() {\n    return this.postService.baseUrlMedia;\n  }\n  getTimeAgo(dateTime) {\n    const now = new Date();\n    const past = new Date(dateTime);\n    const diffMs = now.getTime() - past.getTime();\n    if (isNaN(past.getTime())) {\n      return 'Invalid date';\n    }\n    const seconds = Math.floor(diffMs / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    const months = Math.floor(days / 30);\n    const years = Math.floor(days / 365);\n    if (seconds < 60) {\n      return `since ${seconds} second${seconds !== 1 ? 's' : ''} ago`;\n    }\n    if (minutes < 60) {\n      return `since ${minutes} minute${minutes !== 1 ? 's' : ''} ago`;\n    }\n    if (hours < 24) {\n      return `since ${hours} hour${hours !== 1 ? 's' : ''} ago`;\n    }\n    if (days < 30) {\n      return `since ${days} day${days !== 1 ? 's' : ''} ago`;\n    }\n    if (months < 12) {\n      return `since ${months} month${months !== 1 ? 's' : ''} ago`;\n    }\n    return `since ${years} year${years !== 1 ? 's' : ''} ago`;\n  }\n  getFullMediaPost(path) {\n    return `${this.getBaseUrlForMedia()}${path}`;\n  }\n  isImage(media) {\n    return /\\.(jpg|jpeg|png|gif|webp)$/i.test(media);\n  }\n  isVideo(media) {\n    return /\\.(mp4|webm|ogg)$/i.test(media);\n  }\n  closeDropdown() {\n    this.edit = false;\n    this.isDropdownOpen = false;\n  }\n  onEditPost(post) {\n    this.edit = true;\n    this.editId = post.id;\n  }\n  savePostEdit(postResponse) {\n    const post = new PostRequest(postResponse.id, postResponse.content, postResponse.media);\n    this.postService.updatePost(post).subscribe(success => {\n      this.closeDropdown();\n      this.showSnackBar('Updated', SnackbarPanelClass.Success);\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  onDeletePost(post) {\n    this.postService.deletePost(post.id).subscribe(success => {\n      this.removePostLocal(post.id);\n      this.closeDropdown();\n      this.showSnackBar('Deleted', SnackbarPanelClass.Success);\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  removePostLocal(postId) {\n    this.postsResponse.data = this.postsResponse.data.filter(p => p.id !== postId);\n  }\n  onScroll() {\n    this.page++;\n    this.getAllPosts();\n  }\n  isCurrentUserPost(post) {\n    return post.account?.id.toString() === this.authService.getAccountId();\n  }\n  getAllPosts() {\n    this.postService.getAllPosts(this.page, this.limit).subscribe(response => {\n      if (this.page === 1) {\n        this.postsResponse = response;\n      } else {\n        this.postsResponse.data.push(...response.data);\n      }\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  searchByContent(content) {\n    this.postService.searchByContent(this.page, this.limit, content).subscribe(response => {\n      if (this.page === 1) {\n        this.postsResponse = response;\n      } else {\n        this.postsResponse.data.push(...response.data);\n      }\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  // Toggle like functionality\n  toggleLike(post) {\n    if (post.liked) {\n      this.removeReact(post.id);\n    } else {\n      const reactionRequest = new ReactionRequestVm(post.id, ReactionType.LIKE);\n      this.makeReact(reactionRequest);\n    }\n  }\n  makeReact(reactionRequestVm) {\n    this.reactionService.makeReact(reactionRequestVm).subscribe(response => {\n      const postFounded = this.postsResponse.data.find(p => p.id === reactionRequestVm.postId);\n      postFounded.liked = 1;\n      postFounded.reactionsCount++;\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  removeReact(postId) {\n    this.reactionService.removeReact(postId).subscribe(response => {\n      const postFounded = this.postsResponse.data.find(p => p.id === postId);\n      postFounded.liked = 0;\n      postFounded.reactionsCount--;\n    }, errors => {\n      this.showSnackBar(errors.error.bundleMessage.message_en, SnackbarPanelClass.Error);\n    });\n  }\n  comments(postId) {\n    const dialogRef = this.dialog.open(DialogCommentsComponent, {\n      width: '600px',\n      data: {\n        post_id: postId\n      }\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result) {\n        console.log('Name:', result.countComments);\n        const postFounded = this.postsResponse.data.find(p => p.id === result.postId);\n        postFounded.commentsCount += result.countComments;\n      }\n    });\n  }\n  showSnackBar(message, snackType) {\n    this.snackBar.open(message, 'Close', {\n      duration: 3000,\n      // milliseconds\n      verticalPosition: 'bottom',\n      // or 'top'\n      panelClass: [snackType]\n    });\n  }\n};\nMainPageComponent = __decorate([Component({\n  standalone: true,\n  imports: [CommonModule, FormsModule, LeftBarComponent, RightBarComponent, PublishComponent, InfiniteScrollModule],\n  selector: 'app-main-page',\n  templateUrl: './main-page.component.html',\n  styleUrls: ['./main-page.component.css']\n})], MainPageComponent);\nexport { MainPageComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}